<!doctype html>
<html>
	<head>
		<title>FabricJS</title>
		<script src="./libs/jquery/dist/jquery.js"></script>
		<script src="./libs/fabric.js-1.7.18/dist/fabric.js"></script>
		<script>
			/**
			 * GETパラメータをパースする
			 */
			var param = (function(){
				var url = window.location.href;
				var paramsArray = [];
				parameters = url.split("?");
				if( parameters.length > 1 ) {
					var params = parameters[1].split("&");
					for ( var i = 0; i < params.length; i++ ) {
						var paramItem = params[i].split("=");
						for( var i2 in paramItem ){
							paramItem[i2] = decodeURIComponent( paramItem[i2] );
						}
						paramsArray.push( paramItem[0] );
						paramsArray[paramItem[0]] = paramItem[1];
					}
				}
				return paramsArray;
			})();

		</script>
	</head>
	<body>
		<div>fabric.js</div>
		<form method="post" action="javascript:;">
			w: <input type="number" name="width" value="" /><br />
			h: <input type="number" name="height" value="" /><br />
		</form>
		<div><canvas id="fabric-canvas"></canvas></div>
		<script>
			try{
				var w = Number(param.width||400);
				var h = Number(param.height||300);
				var json = (param.json||'{}');
			}catch(e){
			}
			console.log(json);
			$('#fabric-canvas').attr({
				'width':w,
				'height':h
			});
			// console.log(w+2, h);

			// FabricJS Canvas を生成
			// データの復元は 呼び出し元(=親ウィンドウ=broccoli-field-fabric.js) が外部から行う。
			window.fabricCanvas = new fabric.Canvas('fabric-canvas');

			function changeSize(){
				var w = Number($('input[name=width]').val());
				var h = Number($('input[name=height]').val());
				$('#fabric-canvas').width(w);
				$('#fabric-canvas').height(h);
			}

			$(window).on('load', function(){
				$('input[name=width]').val( w ).on('change', changeSize);
				$('input[name=height]').val( h ).on('change', changeSize);
			})
		</script>
	</body>
</html>
